<div class="min-h-screen flex bg-gradient-to-br from-gray-900 to-gray-800 text-white">
    <div class="w-64 shrink-0">
        <app-nav class="fixed top-0 left-0 h-screen w-64"></app-nav>
    </div>

    <main class="flex-1 p-6 overflow-y-auto max-h-screen">
        <div class="max-w-4xl mx-auto">
            
            <h1 class="text-4xl font-bold text-violet-400 mb-8">Mi Perfil</h1>

            @if (isLoadingUser) {
                <div class="flex justify-center items-center py-20">
                    <svg class="animate-spin h-10 w-10 text-violet-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                    </svg>
                </div>
            }

            @if (!isLoadingUser && user) {
                <div class="bg-gray-900/80 backdrop-blur-md rounded-2xl border border-gray-700 p-6 md:p-8 flex flex-col md:flex-row items-start gap-6">
                    @if (user.profilePicture) {
                        <img 
                            [src]="user.profilePicture" 
                            alt="Perfil"
                            class="w-24 h-24 md:w-32 md:h-32 rounded-full border-4 border-violet-500 object-cover shrink-0">
                    } @else {
                        <div class="w-24 h-24 md:w-32 md:h-32 rounded-full bg-violet-600 flex items-center justify-center text-white font-bold text-3xl border-4 border-violet-500 shrink-0">
                            {{ user.username | initials }}
                        </div>
                    }
                    <div class="flex-1">
                        <div class="flex items-baseline gap-3">
                            <h2 class="text-3xl font-bold text-white">{{ user.username }}</h2>
                            @if (isAdmin) {
                                <span class="bg-violet-600 text-violet-100 text-xs font-semibold px-2.5 py-0.5 rounded-full">ADMIN</span>
                            }
                        </div>
                        
                        <p class="text-lg text-gray-300">{{ user.name }} {{ user.surname }}</p>
                        
                        <p class="text-md text-violet-400 mt-1">{{ user.email }}</p>
                        
                        <p class="text-gray-400 mt-4">{{ user.description || 'Este usuario no ha agregado una descripciÃ³n.' }}</p>
                        
                        <p class="text-sm text-gray-500 mt-2">Miembro desde: {{ user.createdAt | date:'longDate' }}</p>
                    </div>
                </div>
            }

            <div class="mt-12">
                <h3 class="text-2xl font-semibold text-gray-200 mb-6">Mis Ãšltimas 3 Publicaciones</h3>

                @if (isLoadingPosts) {
                    <div class="flex justify-center items-center py-20">
                        <svg class="animate-spin h-8 w-8 text-violet-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                        </svg>
                    </div>
                }

                @if (!isLoadingPosts && publications.length > 0) {
                    <div class="space-y-6">
                        @for (publication of publications; track publication._id) {
                            <app-publication-card
                                [publication]="publication"
                                [currentUserId]="currentUserId"
                                [isAdmin]="isAdmin"
                                (onLike)="darLike($event)"
                                (onUnlike)="quitarLike($event)"
                                (onDelete)="manejarBorrar($event)">
                            </app-publication-card>
                            
                            }
                    </div>
                }

                @if (!isLoadingPosts && publications.length === 0) {
                    <div class="text-center py-12 bg-gray-900/50 rounded-lg border border-dashed border-gray-700">
                        <div class="text-5xl mb-4">ðŸ“ª</div>
                        <h2 class="text-xl font-bold text-gray-400 mb-2">No has publicado nada</h2>
                        <p class="text-gray-500">Â¡Comparte tu primera publicaciÃ³n desde la pestaÃ±a de 'Publicaciones'!</p>
                    </div>
                }

            </div>
        </div>
    </main>
</div>